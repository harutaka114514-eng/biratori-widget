<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>biratori-widget-fixed</title>
<style>
/* æ—¢å­˜ã®ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
body {
  font-family: "Segoe UI", "Hiragino Sans", "Noto Sans JP", sans-serif;
  background-color: #f0f0f0;
  background-position: center; background-size: cover; background-attachment: fixed; background-repeat: no-repeat;
  transition: background-image 0.5s ease-in-out;
  padding: 15px; color: #333; margin: 0;
}
body::before {
  content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.4); z-index: -1;
}

h1 { margin: 5px 0 10px; font-size: 20px; font-weight: 600; text-align: center; text-shadow: 1px 1px 2px white; }
.widgets { display: flex; flex-direction: column; gap: 15px; max-width: 1200px; margin: 0 auto; }
.widget { background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 18px; box-shadow: 0 10px 25px rgba(0,0,0,.1); display: flex; flex-direction: column; box-sizing: border-box; }

.top-row { display: grid; grid-template-columns: 1fr 200px; gap: 12px; align-items: stretch; }
.info-bar { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
#clock { font-size: 22px; font-weight: 700; font-family: monospace; white-space: nowrap; }
.extra-info { display: flex; gap: 15px; flex-grow: 1; justify-content: center; border-left: 1px solid #ddd; border-right: 1px solid #ddd; padding: 0 15px; margin: 0 5px; overflow: hidden; }
.info-item { text-align: center; min-width: 0; flex: 1; display: flex; flex-direction: column; justify-content: center; }
.info-item .label { font-size: 10px; color: #888; display: block; margin-bottom: 3px; font-weight: bold; }
.info-item .content { font-size: 15px; font-weight: 700; color: #222; line-height: 1.3; }

.weekly-weather { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
.weather-day { text-align: center; font-size: 10px; }
.temp-max { color: #ef4444; font-weight: bold; }
.temp-min { color: #3b82f6; font-weight: bold; }

.garbage-button { background: #fef3c7; border-radius: 12px; padding: 10px; font-size: 13px; border: 1px solid #f59e0b; text-align: center; display: flex; flex-direction: column; justify-content: center; cursor: pointer; font-weight: bold; text-decoration: none; color: #92400e; min-height: 70px; }

/* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ */
.main-layout { display: grid; grid-template-columns: 1fr 350px; gap: 15px; }
.video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; background: #000; }
.video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
.video-tabs { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
.video-tabs button { flex: 1; min-width: 70px; padding: 8px 5px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 11px; background: #eee; color: #666; }
.video-tabs button.active { background: #ff0000; color: #fff; }

/* ä¸‹æ®µï¼šãƒªãƒ³ã‚¯ã¨ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
.bottom-widgets { display: grid; grid-template-columns: 220px 1fr; gap: 12px; margin-top: 15px; }

.link-box { display: flex; flex-direction: column; gap: 8px; justify-content: center; height: 100%; }
.link-box a { position: relative; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 10px; border-radius: 12px; text-decoration: none; font-weight: bold; font-size: 13px; transition: transform 0.1s; border: 1px solid rgba(0,0,0,0.1); }
.link-box a:active { transform: scale(0.98); }
.btn-gmail { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }
.btn-deepl { background-color: #0f2d37; color: #ffffff; border-color: #000; }
.btn-okuyami { background-color: #f1f5f9; color: #334155; border-color: #cbd5e1; }
.btn-bear { background-color: #fff7ed; color: #9a3412; border-color: #fed7aa; }
.btn-bosai { background-color: #fffbeb; color: #b45309; border-color: #f59e0b; }
.btn-koho { background-color: #e0f2fe; color: #0369a1; border-color: #bae6fd; }
.btn-doshin { background-color: #fce7f3; color: #9d174d; border-color: #fbcfe8; }
.btn-radio { background-color: #006eb1; color: #ffffff; border-color: #004d7c; }

/* ãƒ‹ãƒ¥ãƒ¼ã‚¹ ã‚¹ã‚¿ã‚¤ãƒ« */
.news-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 5px; }
.news-tabs { display: flex; gap: 4px; flex-wrap: wrap; }
.news-tabs button { padding: 4px 8px; font-size: 10px; background: #e5e7eb; border: 0; border-radius: 999px; cursor: pointer; }
.news-tabs button.active { background: #2563eb; color: #fff; }

.news-controls { display: flex; gap: 5px; align-items: center; }
.refresh-btn { padding: 4px 8px; font-size: 9px; background: #fff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; color: #666; white-space: nowrap; }
.refresh-btn:hover { background: #f0f0f0; }

.news-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 8px; }
.news-list li { background: #fff; border-radius: 8px; padding: 10px; border: 1px solid #eee; display: flex; align-items: flex-start; gap: 8px; transition: background 0.2s; }

.news-list a { text-decoration: none; color: #2563eb; font-size: 12px; font-weight: 700; line-height: 1.4; flex: 1; }
.news-list li.is-read { background: #fdfdfd; }
.news-list li.is-read a { color: #800080 !important; }

.unread-dot { width: 8px; height: 8px; background-color: #ef4444; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
.is-read .unread-dot { display: none; }

.badge { position: absolute; top: -5px; right: -5px; width: 12px; height: 12px; background: #ef4444; border-radius: 50%; border: 2px solid white; display: none; }
.badge.show { display: block; animation: pulse 2s infinite; }

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
.cal-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.cal-btn { background: none; border: none; font-size: 20px; cursor: pointer; color: #2563eb; font-weight: bold; }
.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
.cal-header { font-size: 12px; font-weight: bold; text-align: center; color: #666; padding-bottom: 5px; }
.cal-cell { background: #f8fafc; border-radius: 8px; padding: 5px; min-height: 55px; text-align: left; font-size: 12px; display: flex; flex-direction: column; border: 1px solid #edf2f7; }
.cal-num { font-weight: 700; margin-bottom: 2px; }
.sun { color: #ef4444; }
.sat { color: #3b82f6; }
.cal-today { outline: 3px solid #2563eb; background: #eff6ff; z-index: 1; }
.cal-dim { opacity: 0.3; }
.holiday-name { font-size: 9px; color: #ef4444; line-height: 1.1; margin-top: auto; }

@media(max-width:900px){ .main-layout { grid-template-columns: 1fr; } .bottom-widgets { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<h1>biratori-widget</h1>

<div class="widgets">
  <div class="top-row">
    <div class="widget">
      <div class="info-bar">
        <div id="clock">--:--:--</div>
        <div class="extra-info">
          <div class="info-item"><span class="label">ä»Šæ—¥ã®é‹å‹¢</span><div id="fortune" class="content">...</div></div>
          <div class="info-item"><span class="label">å¹³å–ã‚¢ã‚¤ãƒŒèª</span><div id="ainu" class="content">...</div></div>
        </div>
        <div style="text-align:right;">
            <a href="https://tenki.jp/forecast/1/4/2200/1602/10days.html" target="_blank" style="font-size:12px; color:#666; font-weight:bold; background:#eee; padding:2px 6px; border-radius:4px; text-decoration:none;">å¹³å–</a>
            <div id="weather" style="font-size:20px; font-weight:700; cursor:pointer;" onclick="window.open('https://tenki.jp/forecast/1/4/2200/1602/10days.html', '_blank')">--â„ƒ</div>
        </div>
      </div>
      <div id="weekly-weather" class="weekly-weather"></div>
      <div id="warning-bar" style="display:none; margin-top:10px; padding:8px 12px; border-radius:10px; background:#fef2f2; border:1px solid #fca5a5; color:#991b1b; font-size:12px; font-weight:bold; line-height:1.6;"></div>
    </div>
    <a href="https://biratorieisei-hokkaido.jp/biratorieisei/wp-content/uploads/r7biratori.pdf" target="_blank" class="garbage-button">
      ğŸ—‘ R7å¹´åº¦ã”ã¿åé›†PDF<span>ğŸ”¥æœˆæœ¨ / â™»æ°´</span>
    </a>
  </div>

  <div class="main-layout">
    <div class="left-content">
      <div class="widget">
        <div class="video-tabs">
          <button id="btn-v1" class="active" onclick="switchVideo('tvgbZZYS4Nk', 'btn-v1')">HTB</button>
          <button id="btn-v3" onclick="switchVideo('hA46WfBYdgo', 'btn-v3')">STV</button>
          <button id="btn-v2" onclick="switchVideo('c6Gqe6L_xZg', 'btn-v2')">ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©</button>
          <button id="btn-v4" onclick="switchVideo('c7_kqMFDE8c', 'btn-v4')">åœ°éœ‡ãƒ©ã‚¤ãƒ–</button>
        </div>
        <div class="video-container">
          <iframe id="main-video" src="https://www.youtube.com/embed/tvgbZZYS4Nk?autoplay=1&mute=1&enablejsapi=1" frameborder="0" allowfullscreen></iframe>
        </div>
      </div>

      <div class="bottom-widgets">
        <div class="widget">
          <div class="link-box">
            <a href="https://www.nhk.or.jp/radio/player/?ch=r1" target="_blank" class="link-btn btn-radio">
              ğŸ“» NHKãƒ©ã‚¸ã‚ªç¬¬1 (R1)
            </a>

            <a href="https://s.n-kishou.co.jp/w/charge/bosai/bosaid?ba=01&code=0160200" 
               target="_blank" 
               class="link-btn btn-bosai" 
               id="bosai-btn">
              âš ï¸ å¹³å–ç”º é˜²ç½æƒ…å ± <span id="bosai-badge" class="badge"></span>
            </a>

            <a href="https://www.town.biratori.hokkaido.jp/choseijoho/koho_kocho/koho/2/2441.html"
               target="_blank"
               class="link-btn btn-koho"
               id="koho-btn">
              ğŸ“– åºƒå ±ã³ã‚‰ã¨ã‚Š 
            </a>

            <a href="https://www.hokkaido-np.co.jp/hokkaido/area_tomakomai/"
               target="_blank"
               class="link-btn btn-doshin">
              ğŸ“° é“æ–° (è‹«å°ç‰§ãƒ»æ—¥é«˜)
            </a>

            <a href="https://www.town.biratori.hokkaido.jp/soshikikarasagasu/chominka/seikatsukankyokakari/1/1/2/323.html"
               target="_blank"
               class="link-btn btn-bear"
               id="bear-btn"
               onclick="markBearRead()">
              ğŸ» ç†Šæƒ…å ± <span id="bear-badge" class="badge"></span>
            </a>

            <a href="https://okuyami-media.com/category/hokkaido-region/hokkaido-pref/%e5%b9%b3%e5%8f%96%e7%94%ba/" target="_blank" class="link-btn btn-okuyami" id="okuyami-btn" onclick="markOkuyamiRead()">
                ğŸ™ å¹³å–ç”ºãŠãã‚„ã¿ <span id="okuyami-badge" class="badge"></span>
            </a>
            <a href="https://mail.google.com/mail/u/0/#unread" target="_blank" class="link-btn btn-gmail">âœ‰ Gãƒ¡ãƒ¼ãƒ«</a>
            <a href="https://www.deepl.com/translator" target="_blank" class="link-btn btn-deepl">ğŸŒ DeepL ç¿»è¨³</a>
          </div>
        </div>
        <div class="widget">
          <div class="cal-nav">
            <button class="cal-btn" onclick="changeMonth(-1)">â—€</button>
            <div id="calTitle" style="font-weight:bold; font-size:16px;"></div>
            <button class="cal-btn" onclick="changeMonth(1)">â–¶</button>
          </div>
          <div id="calGrid" class="cal-grid"></div>
        </div>
      </div>
    </div>

    <div class="widget">
      <div class="news-header">
        <div class="news-tabs">
          <button data-type="nhk" class="active">NHK</button>
          <button data-type="keizai">çµŒæ¸ˆ</button>
          <button data-type="sakei">åœ°åŸŸ/é£Ÿ</button>
          <button data-type="nl">é“NL</button>
          <button data-type="hobby">è¶£å‘³</button>
          <button data-type="meshi" style="background:#dcfce7;color:#166534;">ğŸ½ï¸ è¿‘æ‰€ã‚ã—</button>
        </div>

      </div>
      <ul id="news" class="news-list"></ul>
      <div id="meshi-panel" style="display:none;"></div>
    </div>
  </div>
</div>

<script>
const urls = { 
  nhk: ["https://www.nhk.or.jp/rss/news/cat0.xml", "https://news.web.nhk/n-data/conf/na/rss/cat6.xml"],
  keizai: "https://diamond.jp/list/feed/rss/dol", 
  sakei: [
    "https://news.google.com/rss/search?q=å¹³å–ç”º&hl=ja&gl=JP&ceid=JP:ja",
    "https://news.google.com/rss/search?q=æ–°åƒæ­³ç©ºæ¸¯&hl=ja&gl=JP&ceid=JP:ja",
    "https://sapporo.keizai.biz/rss.xml",
    "https://tomakomai.goguynet.jp/feed/",
    "https://meshitabi-hokkaido.com/feed/",
    "https://hre-net.com/feed/",
    "https://biratori-shokokai.com/feed",
    "https://gourmet.watch.impress.co.jp/data/rss/1.0/grw/feed.rdf"
  ],
  nl: "https://hokkaido-nl.jp/index.xml",
  hobby: [
    "https://kyoko-np.net/index.xml",
    "https://valorantnews.jp/feed",
    "https://www.valorant4jp.com/rss.xml",
    "https://news.google.com/rss/search?q=%E6%A0%AA%E4%B8%BB%E5%84%AA%E5%BE%85&hl=ja&gl=JP&ceid=JP:ja",
    "https://news.google.com/rss/search?q=%E5%8C%97%E6%B5%B7%E9%81%93%20%E9%81%93%E3%81%AE%E9%A7%85&hl=ja&gl=JP&ceid=JP:ja"
  ] 
};

let newsCache = { nhk: [], keizai: [], sakei: [], nl: [], hobby: [] };
let readNewsLinks = new Set(JSON.parse(localStorage.getItem('read_news_links') || '[]'));

function setRandomBackground() {
  const images = ['https://images.unsplash.com/photo-1441974231531-c6227db76b6e','https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05','https://images.unsplash.com/photo-1501785888041-af3ef285b470','https://images.unsplash.com/photo-1464822759023-fed622ff2c3b','https://images.unsplash.com/photo-1506744038136-46273834b3fb'];
  document.body.style.backgroundImage = `url('${images[Math.floor(Math.random()*images.length)]}?auto=format&fit=crop&w=1600&q=80')`;
}
setRandomBackground();

async function preloadAllNews() {
  const refreshBtn = document.querySelector('.refresh-btn');
  if(refreshBtn) refreshBtn.textContent = "â³ æ›´æ–°ä¸­...";
  
  const rss2json = "https://api.rss2json.com/v1/api.json?rss_url=";
  const fetchPromises = Object.keys(urls).map(async (key) => {
    try {
      let items = [];
      const targetUrls = Array.isArray(urls[key]) ? urls[key] : [urls[key]];
      for (const url of targetUrls) {
        const r = await fetch(rss2json + encodeURIComponent(url));
        const d = await r.json();
        if (d.status === 'ok') {
            const filteredItems = d.items.filter(item => {
                const t = item.title;
                const c = (item.categories || []).map(cat => cat.toLowerCase());
                
                if (t === "Domingo è¨˜äº‹" || t.includes("æ–°ç€è¨˜äº‹ä¸€è¦§") || t.includes("è¨˜äº‹ä¸€è¦§")) return false;
                
                // VALORANT4JPã®ã€Œå¤§ä¼šã€ã‚¿ã‚°ã‚’é™¤å¤–
                if (url.includes("valorant4jp.com")) {
                    if (c.includes("å¤§ä¼š")) return false;
                }
                
                return true;
            });
            items = items.concat(filteredItems);
        }
      }
      
      const seenLinks = new Set();
      const seenTitles = new Set();
      newsCache[key] = items.filter(item => {
          const isDuplicate = seenLinks.has(item.link) || seenTitles.has(item.title);
          if (!isDuplicate) {
              seenLinks.add(item.link);
              seenTitles.add(item.title);
          }
          return !isDuplicate;
      }).sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

      const activeTab = document.querySelector(".news-tabs button.active");
      if (activeTab && activeTab.dataset.type === key) renderNews(key);
    } catch(e) {}
  });
  await Promise.all(fetchPromises);
  if(refreshBtn) refreshBtn.textContent = "ğŸ”„ æ›´æ–°";
}

function renderNews(type) {
  const ul = document.getElementById("news");
  const items = newsCache[type] || [];
  if (items.length === 0) { ul.innerHTML = "<li>ãƒ­ãƒ¼ãƒ‰ä¸­...</li>"; return; }
  
  const count = (type === 'hobby') ? 13 : 15;
  
  ul.innerHTML = items.slice(0, count).map(i => {
    const isRead = readNewsLinks.has(i.link) ? 'is-read' : '';
    return `<li class="${isRead}">
      <span class="unread-dot"></span>
      <a href="${i.link}" target="_blank" onclick="markAsRead('${i.link}', this)">${i.title}</a>
    </li>`;
  }).join('');
}

function markAsRead(link, element) {
  readNewsLinks.add(link);
  localStorage.setItem('read_news_links', JSON.stringify(Array.from(readNewsLinks)));
  if(element) element.closest('li').classList.add('is-read');
}

async function loadWeather() {
  try {
    const r = await fetch("https://api.open-meteo.com/v1/forecast?latitude=42.58&longitude=142.13&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo");
    const d = await r.json();
    const icons = {0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",61:"ğŸŒ§ï¸",71:"â„ï¸",95:"â›ˆï¸"};
    document.getElementById("weather").textContent = `${icons[d.current_weather.weathercode]||"â˜ï¸"} ${Math.round(d.current_weather.temperature)}â„ƒ`;
    let wHtml = "";
    for(let i=0; i<7; i++){
        const dt = new Date(d.daily.time[i]);
        wHtml += `<div class="weather-day"><div>${dt.getMonth()+1}/${dt.getDate()}</div><div style="font-size:14px;">${icons[d.daily.weathercode[i]]||"â˜ï¸"}</div><div><span class="temp-max">${Math.round(d.daily.temperature_2m_max[i])}</span>/<span class="temp-min">${Math.round(d.daily.temperature_2m_min[i])}</span></div></div>`;
    }
    document.getElementById("weekly-weather").innerHTML = wHtml;
  } catch(e){}
}

async function checkOkuyami() {
  try {
    const targetUrl = "https://okuyami-media.com/category/hokkaido-region/hokkaido-pref/%e5%b9%b3%e5%8f%96%e7%94%ba/";
    const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`);
    const d = await r.json();
    const parser = new DOMParser();
    const doc = parser.parseFromString(d.contents, 'text/html');
    const latestEntry = doc.querySelector('.entry-title a');
    if (latestEntry) {
      const latestTitle = latestEntry.innerText.trim();
      const lastRead = localStorage.getItem('okuyami_last_title');
      if (lastRead !== latestTitle) {
        document.getElementById('okuyami-badge').classList.add('show');
        localStorage.setItem('okuyami_temp_latest', latestTitle);
      }
    }
  } catch(e) {}
}

function markOkuyamiRead() {
  const latest = localStorage.getItem('okuyami_temp_latest');
  if (latest) {
    localStorage.setItem('okuyami_last_title', latest);
    document.getElementById('okuyami-badge').classList.remove('show');
  }
}

async function checkBearInfo() {
  try {
    const targetUrl = "https://www.town.biratori.hokkaido.jp/soshikikarasagasu/chominka/seikatsukankyokakari/1/1/2/323.html";
    const r = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`);
    const d = await r.json();
    const parser = new DOMParser();
    const doc = parser.parseFromString(d.contents, 'text/html');
    const text = (doc.body && doc.body.innerText) ? doc.body.innerText : "";
    const m = text.match(/æ›´æ–°æ—¥ï¼š\s*(\d{4})å¹´\s*(\d{1,2})æœˆ\s*(\d{1,2})æ—¥/);
    if (m) {
      const yyyy = m[1], mm = String(m[2]).padStart(2, '0'), dd = String(m[3]).padStart(2, '0');
      const latestUpdate = `${yyyy}-${mm}-${dd}`;
      const lastRead = localStorage.getItem('bear_last_update');
      if (lastRead !== latestUpdate) {
        document.getElementById('bear-badge').classList.add('show');
        localStorage.setItem('bear_temp_latest', latestUpdate);
      }
    }
  } catch(e) {}
}

function markBearRead() {
  const latest = localStorage.getItem('bear_temp_latest');
  if (latest) {
    localStorage.setItem('bear_last_update', latest);
    document.getElementById('bear-badge').classList.remove('show');
  }
}

// è­¦å ±ãƒ»æ³¨æ„å ±ã®ç¨®åˆ¥â†’è¡¨ç¤ºåãƒãƒƒãƒ”ãƒ³ã‚°
const WARNING_NAMES = {
  "33": "å¤§é›¨è­¦å ±", "03": "å¤§é›ªè­¦å ±", "04": "æš´é¢¨è­¦å ±", "05": "æš´é¢¨é›ªè­¦å ±",
  "06": "æ³¢æµªè­¦å ±", "07": "é«˜æ½®è­¦å ±", "10": "å¤§é›¨æ³¨æ„å ±", "12": "å¤§é›ªæ³¨æ„å ±",
  "13": "å¼·é¢¨æ³¨æ„å ±", "14": "é¢¨é›ªæ³¨æ„å ±", "15": "æ³¢æµªæ³¨æ„å ±", "16": "é«˜æ½®æ³¨æ„å ±",
  "17": "é›·æ³¨æ„å ±", "18": "èé›ªæ³¨æ„å ±", "19": "æ¿ƒéœ§æ³¨æ„å ±", "20": "ä¹¾ç‡¥æ³¨æ„å ±",
  "21": "ãªã ã‚Œæ³¨æ„å ±", "22": "ä½æ¸©æ³¨æ„å ±", "23": "éœœæ³¨æ„å ±", "24": "ç€æ°·æ³¨æ„å ±",
  "25": "ç€é›ªæ³¨æ„å ±", "32": "æ´ªæ°´è­¦å ±", "35": "æ´ªæ°´æ³¨æ„å ±",
};
const WARNING_LEVEL = { // è­¦å ±=2, æ³¨æ„å ±=1
  "33":2,"03":2,"04":2,"05":2,"06":2,"07":2,"32":2,
  "10":1,"12":1,"13":1,"14":1,"15":1,"16":1,"17":1,"18":1,"19":1,"20":1,"21":1,"22":1,"23":1,"24":1,"25":1,"35":1,
};

async function checkWarning() {
  const bar = document.getElementById('warning-bar');
  const badge = document.getElementById('bosai-badge');
  try {
    const targetUrl = "https://www.jma.go.jp/bosai/warning/data/warning/016000.json";
    const r = await fetch(`https://corsproxy.io/?${encodeURIComponent(targetUrl)}`);
    const data = await r.json();

    // data.areaTypes[].areas[] ã®ä¸­ã‹ã‚‰å¹³å–ç”ºï¼ˆ0160200ï¼‰ã‚’æ¢ã™
    let activeWarnings = [];
    for (const areaType of (data.areaTypes || [])) {
      for (const area of (areaType.areas || [])) {
        if (area.areaCode === "0160200") {
          activeWarnings = (area.warnings || []).filter(w => w.status !== "è§£é™¤");
          break;
        }
      }
    }

    if (activeWarnings.length > 0) {
      badge.classList.add('show');
      const alerts = activeWarnings.filter(w => WARNING_LEVEL[w.code] === 2);
      const advisories = activeWarnings.filter(w => WARNING_LEVEL[w.code] === 1);
      let html = 'âš ï¸ <strong>å¹³å–ç”º é˜²ç½æƒ…å ±</strong>ã€€';
      html += alerts.map(w => `<span style="background:#dc2626;color:#fff;border-radius:4px;padding:1px 7px;margin:0 2px;">${WARNING_NAMES[w.code] || 'è­¦å ±'}</span>`).join('');
      html += advisories.map(w => `<span style="background:#f59e0b;color:#fff;border-radius:4px;padding:1px 7px;margin:0 2px;">${WARNING_NAMES[w.code] || 'æ³¨æ„å ±'}</span>`).join('');
      bar.style.cssText = 'display:block;margin-top:10px;padding:8px 12px;border-radius:10px;background:#fef2f2;border:1px solid #fca5a5;color:#991b1b;font-size:12px;font-weight:bold;line-height:1.6;';
      bar.innerHTML = html;
    } else {
      badge.classList.remove('show');
      bar.style.cssText = 'display:block;margin-top:10px;padding:8px 12px;border-radius:10px;background:#f0fdf4;border:1px solid #86efac;color:#166534;font-size:12px;font-weight:bold;line-height:1.6;';
      bar.innerHTML = 'âœ… å¹³å–ç”ºï¼šç¾åœ¨ã€è­¦å ±ãƒ»æ³¨æ„å ±ã¯ç™ºä»¤ã•ã‚Œã¦ã„ã¾ã›ã‚“';
    }
  } catch(e) {
    badge.classList.remove('show');
    bar.style.cssText = 'display:block;margin-top:10px;padding:8px 12px;border-radius:10px;background:#f1f5f9;border:1px solid #94a3b8;color:#475569;font-size:12px;font-weight:bold;line-height:1.6;';
    bar.innerHTML = `âš ï¸ é˜²ç½æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸï¼š${e.message || e}`;
  }
}

const ainuWords = [
  ["ã‚¤ãƒ©ãƒ³ã‚«ãƒ©ã‡·ã‚šãƒ†", "ã“ã‚“ã«ã¡ã¯"], ["ã‚¤ãƒ¤ãƒ©ã‚¤ã‚±ãƒ¬", "ã‚ã‚ŠãŒã¨ã†"], ["ã‚¹ã‚¤ ã‚¦ãƒŒã‚«ãƒ©ãƒ³ ãƒ­", "ã¾ãŸä¼šã„ã¾ã—ã‚‡ã†"], ["ãƒ’ãƒ³ãƒŠ", "ç¾å‘³ã—ã„"], ["ãƒ”ãƒªã‚«", "è‰¯ã„/ãã‚Œã„"], ["ã‚«ãƒ ã‚¤", "ç¥"], ["ã‚³ã‚¿ãƒ³", "æ‘"], ["ã‚¤ã‚¿ã‡°", "è¨€è‘‰"], ["ãƒã‚»", "å®¶"], ["ã‚¢ãƒš", "ç«"], ["ãƒ¯ãƒƒã‚«", "æ°´"], ["ãƒ¬ãƒ©", "é¢¨"], ["ãƒãƒã‚¦", "æ˜Ÿ"], ["ãƒãƒ¥ã‡·ã‚š", "å¤ªé™½"], ["ã‚·ãƒª", "å¤§åœ°"], ["ã‚±ãƒ©ã‚¢ãƒ³", "å‘³ãŒè‰¯ã„"], ["ã‚¦ã‚§ãƒ³", "æ‚ªã„"], ["ã‚ªã‚½ãƒ³ã‚²", "å˜˜"], ["ã‚¦ã‚§ãƒ³ãƒ—ãƒ¬ã‚¤", "ã„ãŸãšã‚‰ã£å­"], ["ã‚¢ãƒãƒ£", "ãŠã˜ã•ã‚“"], ["ãƒ•ãƒ", "ãŠã°ã‚ã•ã‚“"], ["ã‚¨ã‚«ã‚·", "ãŠã˜ã„ã•ã‚“"], ["ãƒãƒ", "ãŠæ¯ã•ã‚“"], ["ãƒŸãƒ", "ãŠçˆ¶ã•ã‚“"], ["ãƒŒãƒ—ãƒª", "å±±"], ["ãƒŠã‚¤", "æ²¢/å·"], ["ãƒˆ", "æ¹–"], ["ãƒ¬ã‚¿ã‡»", "ç™½ã„"], ["ã‚¯ãƒ³ãƒ", "é»’ã„"], ["ãƒ•ãƒ¬", "èµ¤ã„"], ["ã‚·ãƒ‹ãƒ³ã‚±ãƒƒ", "é’ã„"], ["ã‚·ãƒ¯ãƒ³ã‚±", "é»„è‰²ã„"], ["ã‚·ã‚¦ãƒ³", "ç·‘"], ["ãƒˆãƒãƒƒ", "æ¹¿åœ°"], ["ãƒ‹", "æœ¨"], ["ãƒãƒ ", "è‘‰"], ["ãƒãƒ³ãƒ", "èŠ±"], ["ã‚»ã‡¿", "å·£"], ["ãƒ†ãƒƒãƒ‘", "åŒ…ä¸"], ["ã‚¤ã‚¿ãƒãƒƒ", "ãŠæ¤€"], ["ãƒ‘ãƒ©ãƒ†", "ãŠçš¿"], ["ãƒãƒ³", "å°ã•ã„"], ["ãƒãƒ­", "å¤§ãã„"], ["ãƒ¢ã‚·ã‡¼", "å›½/å³¶"], ["ãƒ¤", "é™¸"], ["ã‚µã‡»", "æ¹¿åŸ"], ["ã‚­ãƒ ãƒ³ã‚«ãƒ ã‚¤", "å±±ã®ç¥(ç†Š)"], ["ãƒ¬ãƒ—ãƒ³ã‚«ãƒ ã‚¤", "æ²–ã®ç¥(ã‚·ãƒ£ãƒ)"], ["ã‚³ã‚¿ãƒ³ã‚³ã‡¿ã‚«ãƒ ã‚¤", "æ‘ã‚’å®ˆã‚‹ç¥(ã‚·ãƒãƒ•ã‚¯ãƒ­ã‚¦)"], ["ã‚¢ãƒšãƒ•ãƒã‚«ãƒ ã‚¤", "ç«ã®å©†æ§˜ç¥"], ["ãƒã‚§ã‡·ã‚š", "é­š/é£Ÿã¹ç‰©"], ["ã‚µãƒ¢ãƒ³", "é®­"], ["ã‚«ãƒ ã‚¤ãƒã‚§ã‡·ã‚š", "ç¥ã®é­š(é®­)"], ["ãƒ¦ã‡°", "é¹¿"], ["ã‚¤ã‚»ãƒ", "ã‚¦ã‚µã‚®"], ["ãƒ›ãƒ¦ã‡·ã‚š", "èµ°ã‚‹"], ["ã‚¢ãƒŒ", "èã"], ["ãƒŒã‚«ãƒ«", "è¦‹ã‚‹"], ["ã‚¤ãƒš", "é£Ÿã¹ã‚‹"], ["ã‚¤ã‚¯", "é£²ã‚€"], ["ãƒŸ", "ç€ã‚‹"], ["ã‚¢ãƒ‹", "æŒã¤"], ["ã‚­", "ã™ã‚‹"], ["ã‚¨ã‚«ãƒƒãƒ", "å­ä¾›"], ["ãƒ˜ã‚«ãƒ", "ç”·ã®å­"], ["ãƒãƒƒãƒãƒ", "å¥³ã®å­"], ["ãƒãƒƒãƒã‚¯", "å¥³æ€§"], ["ã‚¢ã‚¤ãƒŒ", "äººé–“"], ["ã‚·ã‚µã‡º", "æ—¥æœ¬äºº"], ["ã‚¦ãƒˆãƒã‚­", "æ•"], ["ã‚»", "èƒŒè² ã†"], ["ãƒ‹ã‚·", "é›²"], ["ã‚¯ãƒ³ãƒãƒãƒ¥ã‡·ã‚š", "æœˆ"], ["ã‚·", "æœ¬å½“ã®"], ["ã‚¨ãƒˆã‚¥", "é¼»"], ["ã‚·ã‚­", "ç›®"], ["ãƒ‘ãƒ«", "å£"], ["ãƒ†ãƒƒ", "æ‰‹"], ["ã‚±ãƒ", "è¶³"], ["ãƒ«", "é“"], ["ãƒ¤ã‚¤", "è‡ªåˆ†"], ["ã‚¨ãƒ«ãƒ ", "ãƒã‚ºãƒŸ"], ["ã‚·ã‚¿", "çŠ¬"], ["ãƒãƒ£ãƒƒãƒš", "çŒ«"], ["ãƒã‚«ã‡·ã‚š", "é³¥"], ["ã‚ªãƒ³ãƒ", "è€ã„ãŸ"], ["ãƒ†ã‚±", "æ‰‹"], ["ã‚³ã‚¤ã‚­", "ç²ã‚‹"], ["ã‚­ã‚µã‡»", "è€³"], ["ãƒãƒˆãƒ‘", "å†¬ã‚’è¶Šã™"], ["ãƒ‘ã‚¤ã‚«ã‡½", "æ˜¥"], ["ã‚µã‡°", "å¤"], ["ãƒãƒ¥ãƒƒãƒ‘", "ç§‹"], ["ãƒã‚¿", "å†¬"], ["ã‚·ãƒªã‚¦ã‚§ãƒ³", "å¤©æ°—ãŒæ‚ªã„"], ["ã‚·ãƒªãƒ”ãƒªã‚«", "å¤©æ°—ãŒè‰¯ã„"], ["ã‚³ã‚³", "å”çˆ¶"], ["ãƒ¬", "åå‰"], ["ã‚¦ã‚§ãƒ³ãƒš", "æ‚ªã„ã‚‚ã®"], ["ã‚¤ã‚­", "ã€œã™ã‚‹"]
];

let currentViewDate = new Date();
const HOLIDAYS_2026 = {"2026-01-01":"å…ƒæ—¥","2026-01-12":"æˆäººã®æ—¥","2026-02-11":"å»ºå›½è¨˜å¿µã®æ—¥","2026-02-23":"å¤©çš‡èª•ç”Ÿæ—¥","2026-03-20":"æ˜¥åˆ†ã®æ—¥","2026-04-29":"æ˜­å’Œã®æ—¥","2026-05-03":"æ†²æ³•è¨˜å¿µæ—¥","2026-05-04":"ã¿ã©ã‚Šã®æ—¥","2026-05-05":"ã“ã©ã‚‚ã®æ—¥","2026-05-06":"æŒ¯æ›¿ä¼‘æ—¥","2026-07-20":"æµ·ã®æ—¥","2026-08-11":"å±±ã®æ—¥","2026-09-21":"æ•¬è€ã®æ—¥","2026-09-22":"å›½æ°‘ã®ä¼‘æ—¥","2026-09-23":"ç§‹åˆ†ã®æ—¥","2026-10-12":"ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥","2026-11-03":"æ–‡åŒ–ã®æ—¥","2026-11-23":"å‹¤åŠ´æ„Ÿè¬ã®æ—¥"};
function changeMonth(diff) { currentViewDate.setMonth(currentViewDate.getMonth() + diff); drawCal(); }
function drawCal(){
  const year=currentViewDate.getFullYear(), month=currentViewDate.getMonth(), today = new Date();
  document.getElementById("calTitle").textContent=`${year}å¹´ ${month+1}æœˆ`;
  let html = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].map(h => `<div class=\"cal-header\">${h}</div>`).join('');
  const start=new Date(year, month, 1); start.setDate(1 - start.getDay());
  for(let i=0; i<42; i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const dateStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const hName = (d.getFullYear() === 2026) ? HOLIDAYS_2026[dateStr] : "";
    let colorClass = (d.getDay() === 0 || hName) ? "sun" : (d.getDay() === 6 ? "sat" : "");
    const isToday = d.toDateString() === today.toDateString() ? "cal-today" : "";
    const isOtherMonth = d.getMonth() !== month ? "cal-dim" : "";
    html += `<div class=\"cal-cell ${isOtherMonth} ${isToday}\"><div class=\"cal-num ${colorClass}\">${d.getDate()}</div>${hName ? `<div class=\"holiday-name\">${hName}</div>` : ""}</div>`;
  }
  document.getElementById("calGrid").innerHTML=html;
}

function clock(){
  const n=new Date(); const m=n.getMonth()+1, d=n.getDate(), w=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][n.getDay()];
  const h=String(n.getHours()).padStart(2,"0"), i=String(n.getMinutes()).padStart(2,"0"), s=String(n.getSeconds()).padStart(2,"0");
  document.getElementById("clock").innerHTML=`<span style=\"font-size:14px\">${m}/${d}(${w})</span> ${h}:${i}:${s}`;
}

function switchVideo(id, btnId) {
  document.getElementById('main-video').src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&enablejsapi=1`;
  document.querySelectorAll('.video-tabs button').forEach(b => b.classList.remove('active'));
  document.getElementById(btnId).classList.add('active');
}

setInterval(clock, 1000); clock();
const aw = ainuWords[Math.floor(Math.random()*ainuWords.length)];
document.getElementById("ainu").innerHTML = `${aw[0]}<span>(${aw[1]})</span>`;
document.getElementById("fortune").textContent = ["å¹³å–å‰ ğŸ…", "å¤§å‰ ğŸŒŸ", "ä¸­å‰ âœ¨", "å°å‰ ğŸ€", "æœ«å‰ ğŸ"][Math.floor(Math.random()*5)];
loadWeather(); drawCal(); checkOkuyami(); checkBearInfo(); preloadAllNews();
checkWarning(); setInterval(checkWarning, 600000);

document.querySelectorAll(".news-tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".news-tabs button").forEach(x=>x.classList.remove("active"));
    b.classList.add("active"); renderNews(b.dataset.type);
  };
});

// ===== è¿‘æ‰€ã‚ã—ï¼šä»Šé–‹ã„ã¦ã‚‹ãŠåº— =====
const nearbyShops = [
  { name: 'ã„ã“ã„', hours: [null,{open:'10:30',close:'15:00',open2:'17:00',close2:'19:30'},{open:'10:30',close:'15:00',open2:'17:00',close2:'19:30'},{open:'10:30',close:'15:00',open2:'17:00',close2:'19:30'},{open:'10:30',close:'15:00',open2:'17:00',close2:'19:30'},{open:'10:30',close:'15:00',open2:'17:00',close2:'19:30'},{open:'10:30',close:'15:00',open2:'17:00',close2:'19:00'}] },
  { name: 'ã•ã‹ãˆ', hours: [{open:'11:30',close:'14:30'},null,null,null,{open:'17:00',close:'22:00'},{open:'11:30',close:'14:30',open2:'17:00',close2:'22:00'},{open:'11:30',close:'14:30',open2:'17:00',close2:'22:00'}] },
  { name: 'ã¨ã‚Šå¤©', hours: [{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'},null,{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'14:00',open2:'17:00',close2:'21:00'}] },
  { name: 'ãƒ‰ãƒ©ã‚¤ãƒ–ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚«ãƒ©', hours: [{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'},{open:'10:00',close:'18:00'}] },
  { name: 'ã‚†ã‹ã‚‰æ¸©æ³‰', hours: [{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'},{open:'11:00',close:'14:00',open2:'16:00',close2:'19:30'}] },
  { name: 'ãã‚ã¹ã“', hours: [{open:'11:00',close:'14:30',open2:'17:00',close2:'19:00'},{open:'11:00',close:'14:00'},null,{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'14:30',open2:'17:00',close2:'19:00'},{open:'11:00',close:'14:30',open2:'17:00',close2:'19:00'},{open:'11:00',close:'14:30',open2:'17:00',close2:'19:00'}] },
  { name: 'äº”è¡Œå±±', hours: [null,{open:'11:00',close:'14:00'},{open:'11:00',close:'14:00'},{open:'11:00',close:'14:00'},{open:'11:00',close:'14:00'},{open:'11:00',close:'14:00'},{open:'11:00',close:'14:00'}] },
  { name: 'èƒé¾', hours: [{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'},{open:'10:30',close:'19:30'}] },
  { name: 'ãƒ«ãƒ³ãƒ“ãƒ‹', hours: [{open:'11:00',close:'21:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'21:00'},{open:'11:00',close:'21:00'}] },
  { name: 'çœŸé³¥', hours: [{open:'11:30',close:'15:00',open2:'18:00',close2:'23:00'},null,{open:'11:30',close:'15:00',open2:'18:00',close2:'22:30'},{open:'11:30',close:'15:00',open2:'18:00',close2:'22:30'},{open:'11:30',close:'15:00',open2:'18:00',close2:'22:30'},{open:'11:30',close:'15:00',open2:'18:00',close2:'22:30'},{open:'11:30',close:'15:00',open2:'18:00',close2:'22:30'}] },
  { name: 'ã„ãšã¿é£Ÿå ‚', hours: [{open:'11:00',close:'19:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'15:00',open2:'17:00',close2:'19:00'},{open:'11:00',close:'19:00'}] },
];
function shopToMin(t){ if(!t) return null; const [h,m]=t.split(':').map(Number); return h*60+m; }
function isShopOpen(shop){
  const d=new Date(), cur=d.getHours()*60+d.getMinutes(), h=shop.hours[d.getDay()];
  if(!h) return false;
  if(cur>=shopToMin(h.open)&&cur<shopToMin(h.close)) return true;
  if(h.open2&&h.close2&&cur>=shopToMin(h.open2)&&cur<shopToMin(h.close2)) return true;
  return false;
}
function renderOpenShops(){
  const el = document.getElementById('open-shops');
  if(!el) return;
  const open = nearbyShops.filter(isShopOpen);
  if(open.length===0){
    el.innerHTML = '<div style="font-size:11px;color:#999;padding:6px 0 2px;">ğŸ½ï¸ ä»Šé–‹ã„ã¦ã‚‹ãŠåº—ï¼šãªã—</div>';
  } else {
    const tags = open.map(s=>`<span style="display:inline-block;background:#dcfce7;color:#166534;border:1px solid #bbf7d0;border-radius:999px;padding:2px 10px;font-size:11px;font-weight:bold;margin:2px 3px 2px 0;">${s.name}</span>`).join('');
    el.innerHTML = `<div style="padding:6px 0 4px;"><span style="font-size:10px;color:#888;font-weight:bold;">ğŸ½ï¸ ä»Šé–‹ã„ã¦ã‚‹ãŠåº—</span><div style="margin-top:4px;">${tags}</div></div>`;
  }
}
renderOpenShops();
setInterval(renderOpenShops, 60000);

// ===== è¿‘æ‰€ã‚ã— ã‚¿ãƒ– =====
function renderMeshiPanel(){
  const el = document.getElementById('meshi-panel');
  if(!el) return;
  const d = new Date();
  const cur = d.getHours()*60+d.getMinutes();
  const dayNames = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];

  const rows = nearbyShops.map(shop => {
    const h = shop.hours[d.getDay()];
    const open = isShopOpen(shop);
    let timeStr = 'å®šä¼‘æ—¥';
    if(h) {
      timeStr = h.open + 'ã€œ' + h.close;
      if(h.open2) timeStr += ' / ' + h.open2 + 'ã€œ' + h.close2;
    }
    return `
      <li style="background:#fff;border-radius:8px;padding:8px 10px;border:1px solid #eee;display:flex;align-items:center;justify-content:space-between;gap:8px;">
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${open?'#22c55e':'#d1d5db'};flex-shrink:0;${open?'box-shadow:0 0 5px #22c55e;':''}"></span>
          <span style="font-size:13px;font-weight:${open?'700':'400'};color:${open?'#111':'#888'};">${shop.name}</span>
        </div>
        <span style="font-size:10px;color:${open?'#16a34a':'#aaa'};font-family:monospace;white-space:nowrap;">${open?timeStr:'<span style=color:#bbb>'+timeStr+'</span>'}</span>
      </li>`;
  }).join('');

  const openCount = nearbyShops.filter(isShopOpen).length;
  el.innerHTML = `
    <div style="font-size:10px;color:#888;margin-bottom:6px;padding:2px 0;">${dayNames[d.getDay()]}æ›œæ—¥ ï¼ å–¶æ¥­ä¸­ <strong style="color:#16a34a;">${openCount}</strong> åº—</div>
    <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:5px;">${rows}</ul>`;
}

// ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã«è¿‘æ‰€ã‚ã—å¯¾å¿œã‚’è¿½åŠ 
const origTabClick = document.querySelectorAll(".news-tabs button");
origTabClick.forEach(b => {
  b.addEventListener('click', () => {
    origTabClick.forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    const type = b.dataset.type;
    if(type === 'meshi'){
      document.getElementById('news').style.display = 'none';
      document.getElementById('meshi-panel').style.display = 'block';
      renderMeshiPanel();
    } else {
      document.getElementById('news').style.display = '';
      document.getElementById('meshi-panel').style.display = 'none';
      renderNews(type);
    }
  });
});
setInterval(()=>{ if(document.getElementById('meshi-panel').style.display!=='none') renderMeshiPanel(); }, 60000);

</script>
</body>
</html>