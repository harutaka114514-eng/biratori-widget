<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>biratori-widget-fixed</title>
<style>
/* æ—¢å­˜ã®ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã™ã¹ã¦ç¶­æŒ */
body {
  font-family: "Segoe UI", "Hiragino Sans", "Noto Sans JP", sans-serif;
  background-color: #f0f0f0;
  background-position: center; background-size: cover; background-attachment: fixed; background-repeat: no-repeat;
  transition: background-image 0.5s ease-in-out;
  padding: 15px; color: #333; margin: 0;
}
body::before {
  content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.4); z-index: -1;
}

h1 { margin: 5px 0 10px; font-size: 20px; font-weight: 600; text-align: center; text-shadow: 1px 1px 2px white; }
.widgets { display: flex; flex-direction: column; gap: 15px; max-width: 900px; margin: 0 auto; }
.widget { background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 18px; box-shadow: 0 10px 25px rgba(0,0,0,.1); display: flex; flex-direction: column; box-sizing: border-box; }

.top-row { display: grid; grid-template-columns: 1fr 200px; gap: 12px; align-items: stretch; }
.info-bar { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
#clock { font-size: 22px; font-weight: 700; font-family: monospace; white-space: nowrap; }
.extra-info { display: flex; gap: 15px; flex-grow: 1; justify-content: center; border-left: 1px solid #ddd; border-right: 1px solid #ddd; padding: 0 15px; margin: 0 5px; overflow: hidden; }
.info-item { text-align: center; min-width: 0; flex: 1; display: flex; flex-direction: column; justify-content: center; }
.info-item .label { font-size: 10px; color: #888; display: block; margin-bottom: 3px; font-weight: bold; }
.info-item .content { font-size: 15px; font-weight: 700; color: #222; line-height: 1.3; }

/* é€±é–“å¤©æ°—äºˆå ± */
.weekly-weather { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; border-top: 1px solid #eee; padding-top: 10px; }
.weather-day { text-align: center; font-size: 10px; }
.temp-max { color: #ef4444; font-weight: bold; }
.temp-min { color: #3b82f6; font-weight: bold; }

.garbage-button { background: #fef3c7; border-radius: 12px; padding: 10px; font-size: 13px; border: 1px solid #f59e0b; text-align: center; display: flex; flex-direction: column; justify-content: center; cursor: pointer; font-weight: bold; text-decoration: none; color: #92400e; min-height: 70px; }

.video-tabs { display: flex; gap: 10px; margin-bottom: 10px; }
.video-tabs button { flex: 1; padding: 8px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 12px; background: #eee; color: #666; }
.video-tabs button.active { background: #ff0000; color: #fff; }
.video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; background: #000; }
.video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }

.bottom-row { display: grid; grid-template-columns: 1fr 240px 280px; gap: 12px; }
.news-tabs { display: flex; gap: 6px; margin-bottom: 10px; overflow-x: auto; padding-bottom: 8px; }
.news-tabs button { padding: 6px 14px; font-size: 11px; background: #e5e7eb; border: 0; border-radius: 999px; cursor: pointer; white-space: nowrap; }
.news-tabs button.active { background: #2563eb; color: #fff; }
.news-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 5px; }
.news-list li { background: #fff; border-radius: 8px; padding: 8px; border: 1px solid #eee; }
.news-list a { text-decoration: none; color: #1a1a1a; font-size: 12px; font-weight: 600; }

/* ã‚¹ãƒ­ãƒƒãƒˆUI */
.slot-widget { text-align: center; }
.slot-reels { display: flex; justify-content: center; gap: 5px; margin: 10px 0; }
.slot-reel { background: #fff; color: #000; width: 55px; height: 75px; line-height: 75px; font-size: 40px; border-radius: 8px; border: 3px solid #ddd; font-weight: bold; }
.slot-btn { padding: 8px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 13px; margin-bottom: 5px; }
.start-btn { background: #ff4757; color: white; width: 100%; }
.start-btn:disabled { background: #ccc; cursor: not-allowed; }
.stop-btns { display: flex; gap: 5px; }
.stop-btn { background: #3498db; color: white; flex: 1; }
.stop-btn:disabled { background: #ccc; }
#slot-msg { font-size: 11px; font-weight: bold; margin-top: 5px; color: #d35400; min-height: 15px; }

/* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UI */
.cal-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
.cal-btn { background: none; border: none; font-size: 18px; cursor: pointer; color: #2563eb; font-weight: bold; }
.cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; }
.cal-header { font-size: 10px; font-weight: bold; text-align: center; color: #666; }
.cal-cell { background: #f8fafc; border-radius: 5px; padding: 3px; min-height: 40px; text-align: center; font-size: 11px; display: flex; flex-direction: column; }
.cal-num { font-weight: 700; }
.sun { color: #ef4444; }
.sat { color: #3b82f6; }
.cal-today { outline: 2px solid #2563eb; background: #eff6ff; }
.cal-dim { opacity: 0.3; }
.holiday-name { font-size: 8px; color: #ef4444; line-height: 1; margin-top: 2px; }

#win-player-container { position: absolute; left: -9999px; }

@media(max-width:900px){ .bottom-row { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<h1>biratori-widget</h1>

<div class="widgets">
  <div class="top-row">
    <div class="widget">
      <div class="info-bar">
        <div id="clock">--:--:--</div>
        <div class="extra-info">
          <div class="info-item"><span class="label">ä»Šæ—¥ã®é‹å‹¢</span><div id="fortune" class="content">...</div></div>
          <div class="info-item"><span class="label">å¹³å–ã‚¢ã‚¤ãƒŒèª</span><div id="ainu" class="content">...</div></div>
        </div>
        <div style="text-align:right;">
            <a href="https://tenki.jp/forecast/1/2/2110/1601/" target="_blank" style="font-size:12px; color:#666; font-weight:bold; background:#eee; padding:2px 6px; border-radius:4px; text-decoration:none;">å¹³å–</a>
            <div id="weather" style="font-size:20px; font-weight:700;">--â„ƒ</div>
        </div>
      </div>
      <div id="weekly-weather" class="weekly-weather"></div>
    </div>
    <a href="https://biratorieisei-hokkaido.jp/biratorieisei/wp-content/uploads/r7biratori.pdf" target="_blank" class="garbage-button">
      ğŸ—‘ R7å¹´åº¦ã”ã¿åé›†PDF<span>ğŸ”¥æœˆæœ¨ / â™»æ°´</span>
    </a>
  </div>

  <div class="widget">
    <div class="video-tabs">
      <button id="btn-v1" class="active" onclick="switchVideo('tvgbZZYS4Nk', 'btn-v1')">HTB</button>
      <button id="btn-v3" onclick="switchVideo('hA46WfBYdgo', 'btn-v3')">STV</button>
      <button id="btn-v2" onclick="switchVideo('c6Gqe6L_xZg', 'btn-v2')">ãƒ©ã‚¤ãƒ–ã‚«ãƒ¡ãƒ©</button>
    </div>
    <div class="video-container">
      <iframe id="main-video" src="https://www.youtube.com/embed/tvgbZZYS4Nk?autoplay=1&mute=1&enablejsapi=1" frameborder="0" allowfullscreen></iframe>
    </div>
  </div>

  <div class="bottom-row">
    <div class="widget">
      <div class="news-tabs">
        <button data-type="nhk" class="active">NHK</button>
        <button data-type="doshin">é“æ–°</button>
        <button data-type="nl">åŒ—æµ·é“NL</button>
        <button data-type="tomakomai">è‹«å°ç‰§</button>
        <button data-type="v4jp">VALORANT</button>
      </div>
      <ul id="news" class="news-list"></ul>
    </div>

    <div class="widget slot-widget">
      <div style="font-weight:bold; font-size:13px;">ğŸ° LUCKY SLOT</div>
      <div id="play-count" style="font-size:10px; color:#888;">æœ¬æ—¥æ®‹ã‚Š: 3å›</div>
      <div class="slot-reels">
        <div id="reel0" class="slot-reel">?</div>
        <div id="reel1" class="slot-reel">?</div>
        <div id="reel2" class="slot-reel">?</div>
      </div>
      <button id="startBtn" class="slot-btn start-btn" onclick="startSlot()">START</button>
      <div class="stop-btns">
        <button id="stop0" class="slot-btn stop-btn" onclick="stopReel(0)" disabled>STOP</button>
        <button id="stop1" class="slot-btn stop-btn" onclick="stopReel(1)" disabled>STOP</button>
        <button id="stop2" class="slot-btn stop-btn" onclick="stopReel(2)" disabled>STOP</button>
      </div>
      <div id="slot-msg">ç‹™ãˆï¼ãƒˆãƒãƒˆæƒã„</div>
    </div>

    <div class="widget">
      <div class="cal-nav">
        <button class="cal-btn" onclick="changeMonth(-1)">â—€</button>
        <div id="calTitle" style="font-weight:bold; font-size:14px;"></div>
        <button class="cal-btn" onclick="changeMonth(1)">â–¶</button>
      </div>
      <div class="cal-grid" id="calGrid"></div>
    </div>
  </div>
</div>

<div id="win-player-container"><div id="win-player"></div></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* --- åŸºæœ¬è¨­å®š & ã‚ªãƒ¼ãƒ‡ã‚£ã‚ª --- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playStopSound(f, d) {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'square'; o.frequency.value = f;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.05, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.start(); o.stop(audioCtx.currentTime + d);
}

let winPlayer;
function onYouTubeIframeAPIReady() {
    winPlayer = new YT.Player('win-player', {
        height: '1', width: '1', videoId: 'GF4bCyltSHw',
        events: { 'onReady': (e) => e.target.setVolume(100) }
    });
}

/* --- èƒŒæ™¯ãƒ©ãƒ³ãƒ€ãƒ æ©Ÿèƒ½ --- */
function setRandomBackground() {
  const images = [
    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e',
    'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05',
    'https://images.unsplash.com/photo-1501785888041-af3ef285b470',
    'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b',
    'https://images.unsplash.com/photo-1506744038136-46273834b3fb'
  ];
  const randomImage = images[Math.floor(Math.random() * images.length)];
  document.body.style.backgroundImage = `url('${randomImage}?auto=format&fit=crop&w=1600&q=80')`;
}
setRandomBackground();

/* --- å¤©æ°—äºˆå ± (API) --- */
async function loadWeather() {
  try {
    const r = await fetch("https://api.open-meteo.com/v1/forecast?latitude=42.58&longitude=142.13&current_weather=true&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo");
    const d = await r.json();
    const icons = {0:"â˜€ï¸",1:"ğŸŒ¤ï¸",2:"â›…",3:"â˜ï¸",45:"ğŸŒ«ï¸",61:"ğŸŒ§ï¸",71:"â„ï¸",95:"â›ˆï¸"};
    document.getElementById("weather").textContent = `${icons[d.current_weather.weathercode]||"â˜ï¸"} ${Math.round(d.current_weather.temperature)}â„ƒ`;
    
    let wHtml = "";
    const days = ["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"];
    for(let i=0; i<7; i++){
        const dt = new Date(d.daily.time[i]);
        wHtml += `<div class="weather-day"><div>${dt.getMonth()+1}/${dt.getDate()}(${days[dt.getDay()]})</div><div style="font-size:16px;">${icons[d.daily.weathercode[i]]||"â˜ï¸"}</div><div><span class="temp-max">${Math.round(d.daily.temperature_2m_max[i])}</span>/<span class="temp-min">${Math.round(d.daily.temperature_2m_min[i])}</span></div></div>`;
    }
    document.getElementById("weekly-weather").innerHTML = wHtml;
  } catch(e){}
}

/* --- ã‚¹ãƒ­ãƒƒãƒˆåˆ¶å¾¡ (3å›åˆ¶é™ãƒ»é€£ç¶šãƒ—ãƒ¬ã‚¤å¯¾å¿œ) --- */
const slotSymbols = ["7", "ğŸ’", "ğŸ…", "ğŸ‡", "ğŸ’"];
let slotTimers = [null, null, null], slotStatus = [false, false, false];
let isWin = false, targetSym = "";

function getPlayCount() {
    const d = JSON.parse(localStorage.getItem('slot_limit_vfinal') || '{}');
    return d.date === new Date().toDateString() ? d.count : 0;
}
function updatePlayCount() {
    const c = getPlayCount() + 1;
    localStorage.setItem('slot_limit_vfinal', JSON.stringify({date: new Date().toDateString(), count: c}));
    displayPlayCount();
}
function displayPlayCount() {
    const r = 3 - getPlayCount();
    document.getElementById("play-count").innerText = `æœ¬æ—¥æ®‹ã‚Š: ${Math.max(0, r)}å›`;
    document.getElementById("startBtn").disabled = (r <= 0);
}

function startSlot() {
  if (getPlayCount() >= 3) return;
  if (winPlayer) winPlayer.stopVideo();
  
  document.getElementById("startBtn").disabled = true;
  document.getElementById("slot-msg").innerText = "å›è»¢ä¸­...";
  isWin = Math.random() < 0.15;
  targetSym = ["7", "ğŸ…"][Math.floor(Math.random()*2)];

  for(let i=0; i<3; i++){
    slotStatus[i] = true; 
    document.getElementById(`stop${i}`).disabled = false;
    slotTimers[i] = setInterval(() => { 
      document.getElementById(`reel${i}`).innerText = slotSymbols[Math.floor(Math.random()*slotSymbols.length)]; 
    }, 80);
  }
}

function stopReel(i) {
  if (!slotStatus[i]) return;
  clearInterval(slotTimers[i]); 
  slotStatus[i] = false;
  document.getElementById(`stop${i}`).disabled = true;
  playStopSound(220, 0.2);
  
  if (isWin) document.getElementById(`reel${i}`).innerText = targetSym;
  
  if (!slotStatus.includes(true)) {
    updatePlayCount();
    const r = [document.getElementById("reel0").innerText, document.getElementById("reel1").innerText, document.getElementById("reel2").innerText];
    if (r[0] === r[1] && r[1] === r[2]) {
      document.getElementById("slot-msg").innerHTML = "<span style='color:red;'>ğŸ‰ å¤§å½“ãŸã‚Šï¼ï¼ ğŸ‰</span>";
      if (winPlayer) { winPlayer.seekTo(0); winPlayer.playVideo(); }
      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    } else {
      document.getElementById("slot-msg").innerText = "ãƒã‚ºãƒ¬...";
    }
    // 3å›ä»¥å†…ãªã‚‰å†åº¦STARTã‚’æœ‰åŠ¹åŒ–
    displayPlayCount();
  }
}

/* --- ã‚¢ã‚¤ãƒŒèª100èª --- */
const ainuWords = [
    ["ã‚¤ãƒ©ãƒ³ã‚«ãƒ©ã‡·ã‚šãƒ†", "ã“ã‚“ã«ã¡ã¯"], ["ã‚¤ãƒ¤ã‚¤ãƒ©ã‚¤ã‚±ãƒ¬", "ã‚ã‚ŠãŒã¨ã†"], ["ã‚¹ã‚¤ ã‚¦ãƒŒã‚«ãƒ©ãƒ³ ãƒ­", "ã¾ãŸä¼šã„ã¾ã—ã‚‡ã†"], ["ãƒ’ãƒ³ãƒŠ", "ç¾å‘³ã—ã„/æ„Ÿè¬"], ["ãƒ”ãƒªã‚«", "è‰¯ã„/ãã‚Œã„"], ["ã‚«ãƒ ã‚¤", "ç¥/éœŠçš„å­˜åœ¨"], ["ã‚³ã‚¿ãƒ³", "æ‘/é›†è½"], ["ã‚¤ã‚¿ã‡°", "è¨€è‘‰/è©±ã™"], ["ãƒã‚»", "å®¶"], ["ã‚¢ãƒš", "ç«"],
    ["ãƒ¯ãƒƒã‚«", "æ°´"], ["ãƒ¬ãƒ©", "é¢¨"], ["ãƒãƒã‚¦", "æ˜Ÿ"], ["ãƒãƒ¥ã‡·ã‚š", "å¤ªé™½/æœˆ"], ["ã‚·ãƒª", "å¤§åœ°"], ["ã‚¦ãƒãƒ", "æ­Œ"], ["ãƒªãƒ ã‚»", "è¸Šã‚Š"], ["ãƒ ãƒƒã‚¯ãƒª", "å£ç´"], ["ãƒˆãƒ³ã‚³ãƒª", "äº”å¼¦ç´"], ["ã‚¤ã‚ªãƒãƒ³ãƒ†", "å„€å¼"],
    ["ã‚¢ãƒˆã‚¥ã‚¤", "æµ·"], ["ãƒŠã‚¤", "å·"], ["ãƒšãƒƒ", "å·"], ["ãƒŒãƒ—ãƒª", "å±±"], ["ã‚­ãƒ ãƒ³", "å±±ã®ã»ã†"], ["ãƒ”ãƒ©", "å´–"], ["ã‚µãƒ«", "æ¹¿åŸ"], ["ãƒ‹ã‚¿ã‚¤", "æ£®"], ["ãƒ‹", "æœ¨"], ["ãƒãƒ³ãƒ", "èŠ±"],
    ["ã‚¢ãƒ‘ãƒ", "èŠ±"], ["ãƒˆãƒ‹", "ãƒŠãƒ©"], ["ã‚¿ãƒƒãƒ‹", "ã‚«ãƒ³ãƒ"], ["ãƒã‚«ã‡·ã‚š", "é³¥"], ["ãƒ¦ã‡°", "é¹¿"], ["ã‚­ãƒ ãƒ³ã‚«ãƒ ã‚¤", "ç†Š"], ["ãƒã‚§ã‡·ã‚š", "é­š"], ["ã‚«ãƒ ã‚¤ãƒã‚§ã‡·ã‚š", "é®­"], ["ãƒ›ãƒ­ã‚±ã‚¦", "ç‹¼"], ["ãƒ¬ãƒ—ãƒ³ã‚«ãƒ ã‚¤", "ã‚·ãƒ£ãƒ"],
    ["ãƒãƒ­ãƒ³ãƒŒã‡·ã‚š", "ã‚­ãƒ„ãƒ"], ["ã‚¤ã‚»ãƒ", "ã‚¦ã‚µã‚®"], ["ãƒ¢ãƒ¦ã‡°", "ã‚¿ãƒŒã‚­"], ["ã‚«ãƒ‘ãƒƒ", "çš®"], ["ã‚¢ãƒƒãƒˆã‚¥ã‡±", "æ¨¹çš®è¡£"], ["ãƒ†ãƒãƒƒãƒ‘", "å…¥ã‚Œå¢¨"], ["ã‚¤ã‚¿ãƒ³ã‚­", "æ¤€"], ["ãƒ‹ãƒ", "ç›†"], ["ãƒã‚­ãƒª", "å°åˆ€"], ["ã‚¤ãƒŠã‚¦", "æœ¨å¹£"],
    ["ã‚¦ãƒ‘ã‡±", "é›ª"], ["ãƒ«", "é“"], ["ã‚¯", "å¼“"], ["ã‚¢ã‚¤", "çŸ¢"], ["ã‚«ãƒ¤", "å¸†"], ["ãƒãƒƒãƒ—", "èˆŸ"], ["ãƒ©ãƒƒãƒãƒ£ã‚³", "ç¯æ˜"], ["ã‚µãƒ©ãƒ³ãƒ‘", "ã•ã‚ˆã†ãªã‚‰"], ["ã‚¦ã‚§ãƒ³", "æ‚ªã„"], ["ã‚¨ã‚«ã‚·", "é•·è€/ç¥–çˆ¶"],
    ["ãƒ•ãƒ", "ç¥–æ¯"], ["ã‚ªã‚­ã‚¯ãƒ«ãƒŸ", "æ–‡åŒ–ç¥"], ["ã‚³ãƒ­ãƒãƒƒã‚¯ãƒ«", "è•—ã®ä¸‹ã®äºº"], ["ãƒ‹ãƒ–ã‚¿ãƒ‹", "äºŒé¢¨è°·"], ["ã‚·ã‚·ãƒªãƒ ã‚«", "æ²™æµå·"], ["ã‚¨ãƒˆã‚¥", "é¼»/å²¬"], ["ã‚­ã‚­ãƒª", "è™«"], ["ã‚±ãƒ", "è¶³"], ["ãƒ†ã‚±", "æ‰‹"], ["ã‚·ã‚­", "ç›®"],
    ["ãƒ‘ãƒ©", "å£"], ["ãƒ¬ã‡·ã‚š", "æ²–"], ["ãƒ¤", "é™¸"], ["ãƒãƒƒ", "ã‚ã”"], ["ãƒ«ãƒ«", "æ±"], ["ã‚¢ãƒãƒ ", "ç©€ç‰©/ã”é£¯"], ["ãƒˆã‚«ã‡·ã‚š", "æ˜¼"], ["ã‚¯ãƒ³ãƒ", "é»’/å¤œ"], ["ãƒ¬ãƒ©", "é¢¨"], ["ã‚»ã‚¿", "çŠ¬"],
    ["ãƒãƒ£ãƒƒãƒ”", "é›¨"], ["ãƒ«ãƒ¼", "é“"], ["ã‚¦ã‚§ãƒ³ãƒš", "æ‚ªã„å¥´"], ["ã‚³ãƒ³ã‚«ãƒ‹", "é‡‘"], ["ã‚·ãƒ­ã‚«ãƒ‹", "éŠ€"], ["ãƒãƒ", "æ¯"], ["ãƒŸãƒ", "çˆ¶"], ["ã‚¢ã‚·ãƒª", "æ–°ã—ã„"], ["ãƒ‹ã‚µãƒƒã‚¿", "æ˜æ—¥"], ["ãƒ˜ã‚«ãƒƒãƒ†ã‚£", "å­ä¾›"],
    ["ãƒãƒƒãƒ", "å¥³"], ["ãƒ”ãƒ³ãƒ", "ç”·"], ["ã‚¯ãƒƒãƒãƒ£ãƒ­", "å–‰"], ["ãƒˆ", "æ¹–"], ["ã‚µãƒƒ", "ä¹¾ã„ãŸ"], ["ãƒ¤ã‡º", "å†·ãŸã„"], ["ã‚»ã‚»ã‡°", "ç†±ã„"], ["ãƒ¬ãƒ©ã‚³ãƒ­", "é¢¨ãŒã‚ã‚‹"], ["ã‚¦ãƒãƒã‚¤", "æ°‘æ—å…±ç”Ÿè±¡å¾´ç©ºé–“"], ["ãƒ”ãƒªã‚«ãƒ¬", "ç¾ã—ãã™ã‚‹"]
];

/* --- æ™‚è¨ˆæ©Ÿèƒ½ --- */
function clock(){
  const n=new Date();
  const m=n.getMonth()+1, d=n.getDate(), w=['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'][n.getDay()];
  const h=String(n.getHours()).padStart(2,"0"), i=String(n.getMinutes()).padStart(2,"0"), s=String(n.getSeconds()).padStart(2,"0");
  document.getElementById("clock").innerHTML=`<span style="font-size:14px">${m}/${d}(${w})</span> ${h}:${i}:${s}`;
}

/* --- ãƒ‹ãƒ¥ãƒ¼ã‚¹ (5ç¨®é¡) --- */
async function loadNews(t){
  const ul=document.getElementById("news");
  const urls={ nhk:"https://www.nhk.or.jp/rss/news/cat0.xml", doshin:"https://www.hokkaido-np.co.jp/output/7/free/index.ad.xml", nl:"https://hokkaido-nl.jp/index.xml", tomakomai:"https://tomakomai.goguynet.jp/feed/", v4jp:"https://valorantnews.jp/feed" };
  ul.innerHTML="<li>å–å¾—ä¸­...</li>";
  try {
    const r = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(urls[t])}`);
    const d = await r.json();
    ul.innerHTML = d.items.slice(0, 5).map(i => `<li><a href="${i.link}" target="_blank">${i.title}</a></li>`).join('');
  } catch(e){ ul.innerHTML="<li>å–å¾—å¤±æ•—</li>"; }
}

/* --- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ (2026å¹´ç¥æ—¥ãƒªã‚¹ãƒˆ) --- */
let currentViewDate = new Date();
const HOLIDAYS_2026 = {"2026-01-01":"å…ƒæ—¥","2026-01-12":"æˆäººã®æ—¥","2026-02-11":"å»ºå›½è¨˜å¿µã®æ—¥","2026-02-23":"å¤©çš‡èª•ç”Ÿæ—¥","2026-03-20":"æ˜¥åˆ†ã®æ—¥","2026-04-29":"æ˜­å’Œã®æ—¥","2026-05-03":"æ†²æ³•è¨˜å¿µæ—¥","2026-05-04":"ã¿ã©ã‚Šã®æ—¥","2026-05-05":"ã“ã©ã‚‚ã®æ—¥","2026-05-06":"æŒ¯æ›¿ä¼‘æ—¥","2026-07-20":"æµ·ã®æ—¥","2026-08-11":"å±±ã®æ—¥","2026-09-21":"æ•¬è€ã®æ—¥","2026-09-22":"å›½æ°‘ã®ä¼‘æ—¥","2026-09-23":"ç§‹åˆ†ã®æ—¥","2026-10-12":"ã‚¹ãƒãƒ¼ãƒ„ã®æ—¥","2026-11-03":"æ–‡åŒ–ã®æ—¥","2026-11-23":"å‹¤åŠ´æ„Ÿè¬ã®æ—¥"};

function changeMonth(diff) { currentViewDate.setMonth(currentViewDate.getMonth() + diff); drawCal(); }
function drawCal(){
  const year=currentViewDate.getFullYear(), month=currentViewDate.getMonth(), today = new Date();
  document.getElementById("calTitle").textContent=`${year}å¹´ ${month+1}æœˆ`;
  let html = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'].map(h => `<div class="cal-header">${h}</div>`).join('');
  const start=new Date(year, month, 1); start.setDate(1 - start.getDay());
  for(let i=0; i<42; i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    const dateStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
    const hName = (d.getFullYear() === 2026) ? HOLIDAYS_2026[dateStr] : "";
    let colorClass = (d.getDay() === 0 || hName) ? "sun" : (d.getDay() === 6 ? "sat" : "");
    const isToday = d.toDateString() === today.toDateString() ? "cal-today" : "";
    const isOtherMonth = d.getMonth() !== month ? "cal-dim" : "";
    html += `<div class="cal-cell ${isOtherMonth} ${isToday}"><div class="cal-num ${colorClass}">${d.getDate()}</div>${hName ? `<div class="holiday-name">${hName}</div>` : ""}</div>`;
  }
  document.getElementById("calGrid").innerHTML=html;
}

function switchVideo(id, btnId) {
  document.getElementById('main-video').src = `https://www.youtube.com/embed/${id}?autoplay=1&mute=1&enablejsapi=1`;
  document.querySelectorAll('.video-tabs button').forEach(b => b.classList.remove('active'));
  document.getElementById(btnId).classList.add('active');
}

// å ã„æ©Ÿèƒ½ã®ãƒ©ãƒ³ãƒ€ãƒ åŒ–
function setFortune() {
  const fortunes = ["å¹³å–å‰ ğŸ…", "å¤§å‰ ğŸŒŸ", "ä¸­å‰ âœ¨", "å°å‰ ğŸ€", "æœ«å‰ ğŸ"];
  document.getElementById("fortune").textContent = fortunes[Math.floor(Math.random() * fortunes.length)];
}

// åˆæœŸåŒ–å®Ÿè¡Œ
setInterval(clock, 1000); clock();
const aw = ainuWords[Math.floor(Math.random()*ainuWords.length)];
document.getElementById("ainu").innerHTML = `${aw[0]}<span>(${aw[1]})</span>`;
setFortune();
loadWeather();
loadNews("nhk");
drawCal();
displayPlayCount();
document.querySelectorAll(".news-tabs button").forEach(b=>{b.onclick=()=>{document.querySelectorAll(".news-tabs button").forEach(x=>x.classList.remove("active"));b.classList.add("active"); loadNews(b.dataset.type);};});
</script>
</body>
</html>